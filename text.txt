Authenticate

Guard và Provider rất quan trọng

Provider định nghĩa sẽ lấy thông tin và truy vấn thông tin đăng nhập thông qua hình thức nào? (Eloquent or DB)

Ví dụ 1 trang web sẽ phân chia đăng nhập thành user & admin

Provider chia làm 2: admin & user
Nếu user sử dụng Eloquent & admin sử dụng DB để lấy thông tin và truy vấn

'providers' => [
    'user' => [
        'driver' => 'eloquent',
        'model' => App\Models\User::class,
    ],
    'admin' => [
        'driver' => 'database',
        'table' => 'admin',
    ]
]

Guard là cách cung cấp logic để XÁC THỰC người dùng thông qua token hoặc session (nếu chọn session, thông tin đăng nhập sẽ đc lưu trữ trong cookie)
người dùng có 2 dạng:
1. user
2. admin 

vì thế bên trong guard ta setting như sau

'guards' => [
    'web' => [
        'provider' => 'user', (sử dụng user đã đc tạo bên trong providers bên trên)
        'driver' => 'session'
    ],
    'admin' => [
        'provider' => 'admin', (sử dụng admin đã đc tạo bên trong providers bên trên)
        'driver' => 'session'
    ]
]

Mặc định thông tin đăng nhập được lưu trữ trong cookie kéo dài tới 3 tiếng
Nên khi ng dùng đã đăng nhập -> sau đó thực hiện các thao tác -> đều luôn đc kiểm tra request với thông tin cookie đang đc lưu trữ
-> nếu hết cookie (sau 3h) -> thì request fail -> đăng nhập lại

còn nếu sử dụng token -> yêu cầu mỗi lần request đều phải sử dụng 1 token mới -> cứ xài là tạo mới


Mặc định 'guards' sẽ lấy thẳng từ th 'web'

'defaults' => [
    'guard' => 'web',
    'passwords' => 'users',
],

Nếu muốn truy vấn lấy dữ liệu ng dùng đã đăng nhập (thông qua provider) thì ta thao tác
-> auth()->id(); hoặc auth()->guard('web')->id(); (vì mặc định 'guard' đã dùng 'web' nên kh cần gọi ra) 
Hoặc
-> auth()->guard('admin')->id();

Vậy làm sao để khi người dùng bắt đầu đăng nhập, sẽ biết được auth() kiểm tra dữ liệu ở bảng user hay admin?
Tương tư như cách truy vấn, thì khi check điều kiện nó cũng thế
--- với user
-> Auth::attempt(['name'=>$request->name,'password'=>$request->password])
--- với admin
-> Auth::guard('admin')->attempt(['name'=>$request->name,'password'=>$request->password])



ban đầu - lấy từ DB ra
/cmart/public/storage/images/banner2.jpeg, /cmart/public/storage/images/c1AtAxKMMxQAAAABJRU5ErkJggg%3D%3D.png

khi đăng thêm 1 tấm
/cmart/public/storage/images/banner2.jpeg, /cmart/public/storage/images/c1AtAxKMMxQAAAABJRU5ErkJggg%3D%3D.png, /cmart/public/storage/images/banner1.jpeg,

Khi đăng thêm 1 tấm VÀ fail update
/cmart/public/storage/images/banner2.jpeg, /cmart/public/storage/images/c1AtAxKMMxQAAAABJRU5ErkJggg%3D%3D.png, /cmart/public/storage/images/banner1.jpeg,

Sau khi fail đăng thêm 1 tấm nữa 
/cmart/public/storage/images/banner2.jpeg, /cmart/public/storage/images/c1AtAxKMMxQAAAABJRU5ErkJggg%3D%3D.png, /cmart/public/storage/images/banner1.jpeg,, /cmart/public/storage/images/daisy.jpg,

FAIL ==> DO SAI CHỖ THÊM ', ' đằng trước chuỗi choosenfile khi nó khác rỗng -> fix

Thêm 1 ảnh ngay khi vào chỉnh sửa
/cmart/public/storage/images/banner2.jpeg, /cmart/public/storage/images/c1AtAxKMMxQAAAABJRU5ErkJggg%3D%3D.png/cmart/public/storage/images/banner2.jpeg,
FAIL ==> DO INPUT LẤY TỪ DB NÊN NÓ MẤT ', ' đằng sau ==> Cách giải quyết --> thêm vào thôi


// KHI CHƯA UPDATE FAIL
BTH = /cmart/public/storage/images/banner2.jpeg, /cmart/public/storage/images/daisy.jpg, /cmart/public/storage/images/banner1.jpeg,
xÓA = /cmart/public/storage/images/banner2.jpeg, /cmart/public/storage/images/banner1.jpeg,

data-url của mỗi ảnh:
/cmart/public/storage/images/banner2.jpeg
/cmart/public/storage/images/daisy.jpg
/cmart/public/storage/images/banner1.jpeg

// KHI UPDATE FAIL
BTH = /cmart/public/storage/images/banner2.jpeg, /cmart/public/storage/images/daisy.jpg, /cmart/public/storage/images/banner1.jpeg,
XÓA = /cmart/public/storage/images/banner2.jpeg,/cmart/public/storage/images/banner1.jpeg,

data-url của mỗi ảnh:
/cmart/public/storage/images/banner2.jpeg
 /cmart/public/storage/images/daisy.jpg
 /cmart/public/storage/images/banner1.jpeg

Dư khoảng trắng -> là lý do bị mất khoảng trắng khi xóa phần tử ở giữa


lấy từ DB
/cmart/public/storage/images/daisy.jpg, /cmart/public/storage/images/trans2.png, (cos khoang trang)
lấy từ old
/cmart/public/storage/images/daisy.jpg, /cmart/public/storage/images/trans2.png, (co khoang trang)

up 2 ảnh 
/cmart/public/storage/images/daisy.jpg, /cmart/public/storage/images/trans2.png, /cmart/public/storage/images/banner1.jpeg, /cmart/public/storage/images/banner2.jpeg,